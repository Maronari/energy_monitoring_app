# Система мониторинга энергопотребления металлообрабатывающего цеха

Информационная система для мониторинга и анализа энергопотребления промышленного оборудования с поддержкой протоколов Modbus RTU/TCP и веб-интерфейсом на базе NiceGUI.

## Возможности системы

### Сбор данных
- Опрос счетчиков электроэнергии "Меркурий 234 ARTM2-00 DPBR.G"
- Опрос ПЛК "ОВЕН ПЛК210-03-CS"
- Поддержка протоколов Modbus RTU/TCP
- Получение данных о мощности, напряжении, токе, состоянии оборудования

### Обработка данных
- Фильтрация шумов и помех
- Проверка данных на соответствие диапазонам
- Выявление аномалий и выбросов
- Преобразование в унифицированный формат

### Передача и хранение
- Передача данных по OPC UA или Modbus TCP
- Структурированное хранение в MySQL
- Хранение временных рядов с привязкой ко времени и оборудованию

### Анализ и мониторинг
- Расчет показателей энергоэффективности (КЭФ)
- Сравнение с критическими значениями
- Выявление неэффективных режимов работы
- Система уведомлений о превышениях норм

### Веб-интерфейс
- Дашборд в реальном времени
- Интерактивные графики и диаграммы
- Визуализация состояния оборудования
- Отображение уведомлений и тревог

### Отчетность
- Автоматическая генерация отчетов
- Экспорт в PDF и Excel
- Настраиваемые шаблоны отчетов
- Анализ за различные периоды

### Администрирование
- Управление пользователями и правами доступа
- Конфигурирование оборудования
- Настройка параметров подключения
- Задание критических значений

## Установка и настройка

### Требования
- Python 3.8+
- MySQL 5.7+ или MariaDB 10.3+
- Сетевое подключение к устройствам Modbus

### Автоматическая установка
```bash
python install.py
```

### Ручная установка

1. Установка зависимостей:
```bash
pip install -r requirements.txt
```

2. Настройка базы данных:
```sql
CREATE DATABASE energy_monitoring CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'energy_user'@'%' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON energy_monitoring.* TO 'energy_user'@'%';
FLUSH PRIVILEGES;
```

3. Настройка конфигурации в `config/settings.py`
# Обновите параметры подключения к БД
```python
self.DATABASE = DatabaseConfig(
    host='localhost',
    port=3306,
    database='energy_monitoring',
    username='energy_user',
    password='your_password'
)
```

# Настройте устройства Modbus
```python
self.MODBUS_DEVICES = [
    ModbusDevice(
        name="Ваш счетчик",
        ip_address="192.168.1.100",
        port=502,
        unit_id=1,
        device_type="meter"
    )
]
```

## Запуск системы

### Разработка
```bash
python main.py
```

### Продакшн (с systemd)
```bash
sudo cp energy-monitoring.service /etc/systemd/system/
sudo systemctl enable energy-monitoring
sudo systemctl start energy-monitoring
```

Веб-интерфейс будет доступен по адресу: http://localhost:8080

## Структура проекта

```
energy-monitoring-system/
├── main.py                 # Главный модуль
├── config/
│   └── settings.py         # Конфигурация системы
├── database/
│   └── db_manager.py       # Менеджер базы данных
├── data_collection/
│   └── modbus_client.py    # Клиент Modbus
├── data_processing/
│   └── processor.py        # Обработка данных
├── analysis/
│   └── analyzer.py         # Анализ данных
├── web_interface/
│   ├── dashboard.py        # Дашборд
│   ├── reports.py          # Отчеты
│   └── admin.py           # Администрирование
├── requirements.txt        # Зависимости
├── install.py             # Скрипт установки
└── README.md              # Документация
```

## Конфигурация устройств

### Счетчик Меркурий 234
- Поддерживаемые регистры: активная/реактивная мощность, напряжение, ток
- Протокол: Modbus RTU/TCP
- Формат данных: 32-битные значения в формате IEEE 754

### ПЛК ОВЕН ПЛК210
- Поддерживаемые регистры: состояние оборудования, дискретные входы
- Протокол: Modbus RTU/TCP
- Модуль дискретного ввода: МВ110-224.16ДН

## API и интеграция

Система предоставляет REST API для интеграции с внешними системами:

- `/api/data/latest` - получение последних данных
- `/api/data/period` - получение данных за период
- `/api/alerts/active` - активные уведомления
- `/api/devices/status` - статус устройств

## Безопасность

- Поддержка TLS для OPC UA
- Хеширование паролей пользователей
- Разграничение прав доступа по ролям
- Логирование всех операций

## Мониторинг и диагностика

- Логирование в файл и консоль
- Мониторинг состояния подключений
- Статистика производительности
- Диагностика ошибок связи

## Поддержка и развитие

Система разработана с учетом возможности расширения:
- Добавление новых типов устройств
- Интеграция с другими протоколами
- Расширение аналитических функций
- Интеграция с ERP/MES системами

## Лицензия

Система разработана для внутреннего использования предприятия.

## Контакты

Для получения поддержки обращайтесь к администратору системы.
